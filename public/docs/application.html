<!DOCTYPE html>  <html> <head>   <title>application.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               application.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <h1>SoundCloud Premiere</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h2>Set Default Options</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <h3>Basic Default Variables</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Declare some default variables that will be used in the application.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">consumer_key</span> <span class="o">=</span> <span class="s2">&quot;ePT3qXXTOjw4ZoZcN7ALQ&quot;</span><span class="o">,</span>
		<span class="nx">url</span> <span class="o">=</span> <span class="s2">&quot;http://soundcloud.com/dominorecordco/sets/qotsa/&quot;</span><span class="o">,</span> </pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>url = "http://soundcloud.com/britneyspears/sets/femmefatale-snippets/",</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">page_title</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">title</span><span class="o">;</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <h3>SoundManager2 Default Options</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Set a few default options for SoundManager2</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">soundManager</span><span class="p">.</span><span class="nx">url</span> <span class="o">=</span> <span class="s1">&#39;/swfs/&#39;</span><span class="o">;</span>
<span class="nx">soundManager</span><span class="p">.</span><span class="nx">flashVersion</span> <span class="o">=</span> <span class="mi">9</span><span class="o">;</span>
<span class="nx">soundManager</span><span class="p">.</span><span class="nx">useFlashBlock</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
<span class="nx">soundManager</span><span class="p">.</span><span class="nx">useHighPerformance</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
<span class="nx">soundManager</span><span class="p">.</span><span class="nx">wmode</span> <span class="o">=</span> <span class="s1">&#39;transparent&#39;</span><span class="o">;</span>
<span class="nx">soundManager</span><span class="p">.</span><span class="nx">useFastPolling</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <h2>Begin Initializing Player</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Wait for jQuery to load</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
	</pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Center Player &amp; Share buttons on page</p>             </td>             <td class="code">               <div class="highlight"><pre>	
	<span class="nx">$</span><span class="p">(</span><span class="nb">window</span><span class="p">).</span><span class="nx">resize</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
		
		<span class="kd">var</span> <span class="nx">$player</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.player&#39;</span><span class="p">)</span><span class="o">,</span>
				<span class="nx">$share</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.share&#39;</span><span class="p">);</span>

		<span class="nx">$player</span><span class="p">.</span><span class="nx">css</span><span class="p">({</span>
			<span class="nx">left</span><span class="o">:</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nb">window</span><span class="p">).</span><span class="nx">width</span><span class="p">()</span> <span class="o">-</span> <span class="nx">$player</span><span class="p">.</span><span class="nx">outerWidth</span><span class="p">())</span> <span class="o">/</span> <span class="mi">2</span><span class="o">,</span>
			<span class="nx">top</span><span class="o">:</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nb">window</span><span class="p">).</span><span class="nx">height</span><span class="p">()</span> <span class="o">-</span> <span class="nx">$player</span><span class="p">.</span><span class="nx">outerHeight</span><span class="p">())</span> <span class="o">/</span> <span class="mi">2</span>
		<span class="p">});</span>
		
		<span class="nx">$share</span><span class="p">.</span><span class="nx">css</span><span class="p">({</span>
			<span class="nx">left</span><span class="o">:</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nb">window</span><span class="p">).</span><span class="nx">width</span><span class="p">()</span> <span class="o">-</span> <span class="nx">$share</span><span class="p">.</span><span class="nx">outerWidth</span><span class="p">())</span> <span class="o">/</span> <span class="mi">2</span>
		<span class="p">});</span>

	<span class="p">});</span>

	<span class="nx">$</span><span class="p">(</span><span class="nb">window</span><span class="p">).</span><span class="nx">resize</span><span class="p">();</span>
	</pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Wait for SoundManager2 to load</p>             </td>             <td class="code">               <div class="highlight"><pre>	
	<span class="nx">soundManager</span><span class="p">.</span><span class="nx">onready</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
		</pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <h2>Get SoundCloud Data</h2>             </td>             <td class="code">               <div class="highlight"><pre>		</pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Resolve the playlist and get its data from SoundCloud</p>             </td>             <td class="code">               <div class="highlight"><pre>		
		<span class="nx">$</span><span class="p">.</span><span class="nx">getJSON</span><span class="p">(</span><span class="s1">&#39;http://api.soundcloud.com/resolve?url=&#39;</span> <span class="o">+</span> <span class="nx">url</span> <span class="o">+</span> <span class="s1">&#39;&amp;format=json&amp;consumer_key=&#39;</span> <span class="o">+</span> <span class="nx">consumer_key</span> <span class="o">+</span> <span class="s1">&#39;&amp;callback=?&#39;</span><span class="o">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">playlist</span><span class="p">){</span>
			</pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Once playlist data is loaded, apply the artwork, user avatar, and user username to the player.</p>             </td>             <td class="code">               <div class="highlight"><pre>			
			<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.artwork&#39;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;background-image&#39;</span><span class="o">,</span> <span class="s1">&#39;url(&#39;</span> <span class="o">+</span> <span class="nx">playlist</span><span class="p">.</span><span class="nx">artwork_url</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;-large&#39;</span><span class="o">,</span> <span class="s1">&#39;-crop&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">).</span><span class="nx">fadeIn</span><span class="p">(</span><span class="s1">&#39;slow&#39;</span><span class="p">);</span>
			
			<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.avatar&#39;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;background-image&#39;</span><span class="o">,</span> <span class="s1">&#39;url(&#39;</span> <span class="o">+</span> <span class="nx">playlist</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">avatar_url</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;-large&#39;</span><span class="o">,</span> <span class="s1">&#39;-badge&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">);</span>
			
			<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.description&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">playlist</span><span class="p">.</span><span class="nx">title</span> <span class="o">+</span> <span class="s1">&#39;&lt;br&gt;by &#39;</span> <span class="o">+</span> <span class="nx">playlist</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">username</span><span class="p">);</span>
			</pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Load the first track's waveform using the <em>loadWaveform</em> function declared later.</p>             </td>             <td class="code">               <div class="highlight"><pre>			
			<span class="nx">loadWaveform</span><span class="p">(</span><span class="nx">playlist</span><span class="p">.</span><span class="nx">tracks</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">waveform_url</span><span class="p">);</span>
			</pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>Loop through each track in the playlist</p>             </td>             <td class="code">               <div class="highlight"><pre>				
			<span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">playlist</span><span class="p">.</span><span class="nx">tracks</span><span class="o">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">index</span><span class="o">,</span> <span class="nx">track</span><span class="p">)</span> <span class="p">{</span>
				</pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>Create a list item for track, associate it's data, and append it to the track list.</p>             </td>             <td class="code">               <div class="highlight"><pre>				
				<span class="kd">var</span> <span class="nx">$li</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;li class=&quot;track_&#39;</span> <span class="o">+</span> <span class="nx">track</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s1">&#39;&quot;&gt;&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;. &#39;</span> <span class="o">+</span> <span class="nx">track</span><span class="p">.</span><span class="nx">title</span> <span class="o">+</span> <span class="s1">&#39;&lt;/li&gt;&#39;</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;track&#39;</span><span class="o">,</span> <span class="nx">track</span><span class="p">).</span><span class="nx">appendTo</span><span class="p">(</span><span class="s1">&#39;.tracks&#39;</span><span class="p">);</span>
				</pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>Find the appropriate stream url depending on whether the track has a secret_token or is public.</p>             </td>             <td class="code">               <div class="highlight"><pre>				
				<span class="nx">url</span> <span class="o">=</span> <span class="nx">track</span><span class="p">.</span><span class="nx">stream_url</span><span class="o">;</span>
				
				<span class="p">(</span><span class="nx">url</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;secret_token&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">?</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">url</span> <span class="o">+</span> <span class="s1">&#39;?&#39;</span> <span class="o">:</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">url</span> <span class="o">+</span> <span class="s1">&#39;&amp;&#39;</span><span class="o">;</span>
				
				<span class="nx">url</span> <span class="o">=</span> <span class="nx">url</span> <span class="o">+</span> <span class="s1">&#39;consumer_key=&#39;</span> <span class="o">+</span> <span class="nx">consumer_key</span><span class="o">;</span>
				</pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <h2>Create the Sound</h2>             </td>             <td class="code">               <div class="highlight"><pre>				
				<span class="kd">var</span> <span class="nx">s</span> <span class="o">=</span> <span class="nx">soundManager</span><span class="p">.</span><span class="nx">createSound</span><span class="p">({</span>
					</pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <h3>Sound Defaults</h3>             </td>             <td class="code">               <div class="highlight"><pre>								</pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <ul>
<li>Auto load the first track</li>
<li>Add an id in the format <em>track_123456</em></li>
<li>Set multiShot to false to make sure track can't play more than once simultaneously </li>
<li>Add the SoundCloud stream url created above</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>					<span class="nx">autoLoad</span><span class="o">:</span> <span class="p">(</span><span class="nx">index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span><span class="o">,</span>
					<span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;track_&#39;</span> <span class="o">+</span> <span class="nx">track</span><span class="p">.</span><span class="nx">id</span><span class="o">,</span>
					<span class="nx">multiShot</span><span class="o">:</span> <span class="kc">false</span><span class="o">,</span>
					<span class="nx">url</span><span class="o">:</span> <span class="nx">url</span><span class="o">,</span>
					<span class="nx">volume</span><span class="o">:</span> <span class="mi">10</span><span class="o">,</span>
					</pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <h3>Sound Functions</h3>             </td>             <td class="code">               <div class="highlight"><pre>					</pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p><strong>While Loading</strong> get the percentage buffered and adjust the buffer width</p>             </td>             <td class="code">               <div class="highlight"><pre>					
					<span class="nx">whileloading</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
						
						<span class="nx">percent</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">bytesLoaded</span> <span class="o">/</span> <span class="k">this</span><span class="p">.</span><span class="nx">bytesTotal</span> <span class="o">*</span> <span class="mi">100</span><span class="o">;</span>

						<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.buffer&#39;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;width&#39;</span><span class="o">,</span> <span class="nx">percent</span> <span class="o">+</span> <span class="s1">&#39;%&#39;</span><span class="p">);</span>
						
					<span class="p">}</span><span class="o">,</span>
					</pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p><strong>While Playing</strong> get the percentage played and adjust the played width</p>             </td>             <td class="code">               <div class="highlight"><pre>					
					<span class="nx">whileplaying</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
						
						<span class="nx">percent</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">position</span> <span class="o">/</span> <span class="nx">track</span><span class="p">.</span><span class="nx">duration</span> <span class="o">*</span> <span class="mi">100</span><span class="o">;</span>

						<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.played&#39;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;width&#39;</span><span class="o">,</span> <span class="nx">percent</span> <span class="o">+</span> <span class="s1">&#39;%&#39;</span><span class="p">);</span>
						
					<span class="p">}</span><span class="o">,</span>
					</pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p><strong>On Play</strong> swap the waveform image, change the page title, and adjust the buffer if it's fully loaded.</p>             </td>             <td class="code">               <div class="highlight"><pre>					
					<span class="nx">onplay</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
						
						<span class="nx">loadWaveform</span><span class="p">(</span><span class="nx">track</span><span class="p">.</span><span class="nx">waveform_url</span><span class="p">);</span>
						
						<span class="nx">loadComments</span><span class="p">(</span><span class="nx">track</span><span class="p">);</span>
						
						<span class="nb">document</span><span class="p">.</span><span class="nx">title</span> <span class="o">=</span> <span class="s1">&#39;\u25B6 &#39;</span> <span class="o">+</span> <span class="nx">track</span><span class="p">.</span><span class="nx">title</span><span class="o">;</span>
					
						<span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">loaded</span> <span class="o">==</span> <span class="kc">true</span><span class="p">){</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.buffer&#39;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;width&#39;</span><span class="o">,</span> <span class="s1">&#39;100%&#39;</span><span class="p">);</span> <span class="p">}</span>	
						
					<span class="p">}</span><span class="o">,</span>
					</pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p><strong>On Resume</strong> change the page title, and adjust the buffer if it's full loaded.</p>             </td>             <td class="code">               <div class="highlight"><pre>					
					<span class="nx">onresume</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
						
						<span class="nb">document</span><span class="p">.</span><span class="nx">title</span> <span class="o">=</span> <span class="s1">&#39;\u25B6 &#39;</span> <span class="o">+</span> <span class="nx">track</span><span class="p">.</span><span class="nx">title</span><span class="o">;</span>
						
						<span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">loaded</span> <span class="o">==</span> <span class="kc">true</span><span class="p">){</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.buffer&#39;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;width&#39;</span><span class="o">,</span> <span class="s1">&#39;100%&#39;</span><span class="p">);</span> <span class="p">}</span>	
						
					<span class="p">}</span><span class="o">,</span>
					</pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p><strong>On Stop</strong> revert the page title to default and set buffer and played's width to 0</p>             </td>             <td class="code">               <div class="highlight"><pre>					
					<span class="nx">onstop</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>						
						
						<span class="nb">document</span><span class="p">.</span><span class="nx">title</span> <span class="o">=</span> <span class="nx">page_title</span><span class="o">;</span>
						
						<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.buffer, .played&#39;</span><span class="p">).</span><span class="nx">width</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>						
						
					<span class="p">}</span><span class="o">,</span>
					</pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p><strong>On Pause</strong> revert the page title</p>             </td>             <td class="code">               <div class="highlight"><pre>					
					<span class="nx">onpause</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
						
						<span class="nb">document</span><span class="p">.</span><span class="nx">title</span> <span class="o">=</span> <span class="nx">page_title</span><span class="o">;</span>
						
					<span class="p">}</span><span class="o">,</span>
					</pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p><strong>On Finish</strong> jump to the next track</p>             </td>             <td class="code">               <div class="highlight"><pre>					<span class="nx">onfinish</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> 
						
						<span class="nx">nextTrack</span><span class="p">();</span> 
						
					<span class="p">}</span>

				<span class="p">});</span>
				</pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <h2>Comments</h2>             </td>             <td class="code">               <div class="highlight"><pre>				</pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>Initialize a new array called <em>comments</em> in the list item data</p>             </td>             <td class="code">               <div class="highlight"><pre>				
				<span class="nx">$li</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;track&#39;</span><span class="p">).</span><span class="nx">comments</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">();</span>
				</pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>Loop until <em>comment_count</em> is reached</p>             </td>             <td class="code">               <div class="highlight"><pre>				
				<span class="k">for</span><span class="p">(</span><span class="nx">offset</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="nx">offset</span> <span class="o">&lt;=</span> <span class="nx">track</span><span class="p">.</span><span class="nx">comment_count</span><span class="o">;</span> <span class="nx">offset</span> <span class="o">+=</span> <span class="mi">50</span><span class="p">)</span> <span class="p">{</span>
					</pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>Get track comments from SoundCloud</p>             </td>             <td class="code">               <div class="highlight"><pre>					<span class="nx">$</span><span class="p">.</span><span class="nx">getJSON</span><span class="p">(</span><span class="s2">&quot;http://api.soundcloud.com/tracks/&quot;</span> <span class="o">+</span> <span class="nx">track</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s2">&quot;/comments.json?offset=&quot;</span> <span class="o">+</span> <span class="nx">offset</span> <span class="o">+</span> <span class="s2">&quot;&amp;consumer_key=&quot;</span> <span class="o">+</span> <span class="nx">consumer_key</span><span class="o">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">comments</span><span class="p">){</span>
						</pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>Loop through each comment</p>             </td>             <td class="code">               <div class="highlight"><pre>						
						<span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">comments</span><span class="o">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="o">,</span> <span class="nx">comment</span><span class="p">)</span> <span class="p">{</span>													
							</pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>Only do something if the comment is timestamped                                                        </p>             </td>             <td class="code">               <div class="highlight"><pre>							
							<span class="k">if</span><span class="p">(</span><span class="nx">comment</span><span class="p">.</span><span class="nx">timestamp</span><span class="p">){</span>
								</pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>Push the timestamped comment into the comments array</p>             </td>             <td class="code">               <div class="highlight"><pre>								
								<span class="nx">$li</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;track&#39;</span><span class="p">).</span><span class="nx">comments</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">comment</span><span class="p">);</span>
								</pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>If this is the first track, load the comment into view</p>             </td>             <td class="code">               <div class="highlight"><pre>								
								<span class="k">if</span><span class="p">(</span><span class="nx">index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="nx">loadComment</span><span class="p">(</span><span class="nx">track</span><span class="o">,</span> <span class="nx">comment</span><span class="p">);</span> <span class="p">}</span>
								</pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>Create a SoundManager2 <strong>On Position</strong> listener event for the comment</p>             </td>             <td class="code">               <div class="highlight"><pre>									
								<span class="nx">s</span><span class="p">.</span><span class="nx">onposition</span><span class="p">(</span><span class="nx">comment</span><span class="p">.</span><span class="nx">timestamp</span><span class="o">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">eventPosition</span><span class="p">)</span> <span class="p">{</span>

									<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">comment</span><span class="p">.</span><span class="nx">body</span><span class="p">);</span>

								<span class="p">});</span>

							<span class="p">}</span>
						
						<span class="p">});</span>
						
					<span class="p">});</span>
					
				<span class="p">}</span>				
				
			<span class="p">});</span>
			</pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <h2>ScrollPane</h2>             </td>             <td class="code">               <div class="highlight"><pre>			</pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>Initialize a jScrollPane for track list
Included in the main index as <em>jquery.jscrollpane.min.js</em></p>             </td>             <td class="code">               <div class="highlight"><pre>			
			<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.tracks&#39;</span><span class="p">).</span><span class="nx">jScrollPane</span><span class="p">({</span>
				
				<span class="nx">showArrows</span><span class="o">:</span> <span class="kc">false</span>
				
			<span class="p">});</span>
			
		<span class="p">});</span>
	
	<span class="p">});</span>
	</pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <h2>GUI Events</h2>             </td>             <td class="code">               <div class="highlight"><pre>	</pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <h3>List Item Click</h3>             </td>             <td class="code">               <div class="highlight"><pre>	</pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <p>Bind a <em>click</em> event to each list item in the track list</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.tracks li&#39;</span><span class="p">).</span><span class="nx">live</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="o">,</span> <span class="kd">function</span><span class="p">(){</span>
		</pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <p>Create variables for the track, its data, and whether or not it's playing <em>(.active)</em></p>             </td>             <td class="code">               <div class="highlight"><pre>		
		<span class="kd">var</span> <span class="nx">$track</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">)</span><span class="o">,</span>
				<span class="nx">data</span> <span class="o">=</span> <span class="nx">$track</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;track&#39;</span><span class="p">)</span><span class="o">,</span>
				<span class="nx">playing</span> <span class="o">=</span> <span class="nx">$track</span><span class="p">.</span><span class="nx">is</span><span class="p">(</span><span class="s1">&#39;.active&#39;</span><span class="p">);</span>
				</pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <p>If is it playing, pause it.</p>             </td>             <td class="code">               <div class="highlight"><pre>				
		<span class="k">if</span> <span class="p">(</span><span class="nx">playing</span><span class="p">)</span> <span class="p">{</span>
			
			<span class="nx">soundManager</span><span class="p">.</span><span class="nx">pause</span><span class="p">(</span><span class="s1">&#39;track_&#39;</span> <span class="o">+</span> <span class="nx">data</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>	
			</pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p>If not, stop all other sounds that might be playing, and play the clicked sound.            </p>             </td>             <td class="code">               <div class="highlight"><pre>			
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			
			<span class="k">if</span> <span class="p">(</span><span class="nx">$track</span><span class="p">.</span><span class="nx">siblings</span><span class="p">(</span><span class="s1">&#39;li&#39;</span><span class="p">).</span><span class="nx">hasClass</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">))</span> <span class="p">{</span> <span class="nx">soundManager</span><span class="p">.</span><span class="nx">stopAll</span><span class="p">();</span> <span class="p">}</span>
			
			<span class="nx">soundManager</span><span class="p">.</span><span class="nx">play</span><span class="p">(</span><span class="s1">&#39;track_&#39;</span> <span class="o">+</span> <span class="nx">data</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
			
		<span class="p">}</span>
		</pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <p>Toggle the active class and remove it from any other list items.</p>             </td>             <td class="code">               <div class="highlight"><pre>		
		<span class="nx">$track</span><span class="p">.</span><span class="nx">toggleClass</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">).</span><span class="nx">siblings</span><span class="p">(</span><span class="s1">&#39;li&#39;</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">);</span>
		
	<span class="p">});</span>
	</pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <h3>Play Button Click</h3>             </td>             <td class="code">               <div class="highlight"><pre>	</pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <p>Bind a <em>click</em> event to the play button</p>             </td>             <td class="code">               <div class="highlight"><pre>	
	<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.button&#39;</span><span class="p">).</span><span class="nx">live</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="o">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
		</pre></div>             </td>           </tr>                               <tr id="section-50">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-50">&#182;</a>               </div>               <p>Click/Play the first track</p>             </td>             <td class="code">               <div class="highlight"><pre>		
		<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;li:first&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">();</span>
		</pre></div>             </td>           </tr>                               <tr id="section-51">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-51">&#182;</a>               </div>               <p>Fade out the play button</p>             </td>             <td class="code">               <div class="highlight"><pre>		
		<span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">fadeOut</span><span class="p">();</span>
		</pre></div>             </td>           </tr>                               <tr id="section-52">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-52">&#182;</a>               </div>               <p>Declare basic animation variables</p>             </td>             <td class="code">               <div class="highlight"><pre>		
		<span class="kd">var</span> <span class="nx">duration</span> <span class="o">=</span> <span class="mi">4000</span><span class="o">,</span>
				<span class="nx">easing</span> <span class="o">=</span> <span class="s1">&#39;swing&#39;</span><span class="o">;</span>
				</pre></div>             </td>           </tr>                               <tr id="section-53">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-53">&#182;</a>               </div>               <p>Animate the left &amp; right panels to swing open</p>             </td>             <td class="code">               <div class="highlight"><pre>		
		<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.left&#39;</span><span class="p">).</span><span class="nx">animate</span><span class="p">({</span>
			<span class="nx">left</span><span class="o">:</span> <span class="mi">0</span><span class="o">,</span>
			<span class="nx">BorderTopRightRadius</span><span class="o">:</span> <span class="mi">0</span><span class="o">,</span>
			<span class="nx">BorderBottomRightRadius</span><span class="o">:</span> <span class="mi">0</span><span class="o">,</span>
			<span class="nx">WebkitBorderTopRightRadius</span><span class="o">:</span> <span class="mi">0</span><span class="o">,</span>
			<span class="nx">WebkitBorderBottomRightRadius</span><span class="o">:</span> <span class="mi">0</span><span class="o">,</span>
			<span class="nx">MozBorderRadiusTopright</span><span class="o">:</span> <span class="mi">0</span><span class="o">,</span>
			<span class="nx">MozBorderRadiusBottomright</span><span class="o">:</span> <span class="mi">0</span>
		<span class="p">}</span><span class="o">,</span> <span class="p">{</span>
			<span class="nx">duration</span><span class="o">:</span> <span class="nx">duration</span><span class="o">,</span>
			<span class="nx">easing</span><span class="o">:</span> <span class="nx">easing</span>
		<span class="p">});</span>

		<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.right&#39;</span><span class="p">).</span><span class="nx">animate</span><span class="p">({</span>
			<span class="nx">left</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.player&#39;</span><span class="p">).</span><span class="nx">width</span><span class="p">()</span> <span class="o">/</span> <span class="mi">2</span><span class="o">,</span>
			<span class="nx">BorderTopLeftRadius</span><span class="o">:</span> <span class="mi">0</span><span class="o">,</span>
			<span class="nx">BorderBottomLeftRadius</span><span class="o">:</span> <span class="mi">0</span><span class="o">,</span>
			<span class="nx">WebkitBorderTopLeftRadius</span><span class="o">:</span> <span class="mi">0</span><span class="o">,</span>
			<span class="nx">WebkitBorderBottomLeftRadius</span><span class="o">:</span> <span class="mi">0</span><span class="o">,</span>
			<span class="nx">MozBorderRadiusTopleft</span><span class="o">:</span> <span class="mi">0</span><span class="o">,</span>
			<span class="nx">MozBorderRadiusBottomleft</span><span class="o">:</span> <span class="mi">0</span>
		<span class="p">}</span><span class="o">,</span> <span class="p">{</span>
			<span class="nx">duration</span><span class="o">:</span> <span class="nx">duration</span><span class="o">,</span>
			<span class="nx">easing</span><span class="o">:</span> <span class="nx">easing</span>
		<span class="p">});</span>
		
	<span class="p">});</span>
	</pre></div>             </td>           </tr>                               <tr id="section-54">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-54">&#182;</a>               </div>               <h3>Time Click &amp; Scrub</h3>             </td>             <td class="code">               <div class="highlight"><pre>	</pre></div>             </td>           </tr>                               <tr id="section-55">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-55">&#182;</a>               </div>               <p>Bind a <em>click</em> event to the time div</p>             </td>             <td class="code">               <div class="highlight"><pre>	
	<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.time&#39;</span><span class="p">).</span><span class="nx">live</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="o">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
		</pre></div>             </td>           </tr>                               <tr id="section-56">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-56">&#182;</a>               </div>               <p>Call the scrub function, handing over the clicks x position</p>             </td>             <td class="code">               <div class="highlight"><pre>		
		<span class="nx">scrub</span><span class="p">(</span><span class="k">this</span><span class="o">,</span> <span class="nx">event</span><span class="p">.</span><span class="nx">pageX</span><span class="p">);</span>
	
	  <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
	
	<span class="p">});</span>
	</pre></div>             </td>           </tr>                               <tr id="section-57">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-57">&#182;</a>               </div>               <h2>Functions</h2>             </td>             <td class="code">               <div class="highlight"><pre>	</pre></div>             </td>           </tr>                               <tr id="section-58">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-58">&#182;</a>               </div>               <h3>Load Waveform</h3>             </td>             <td class="code">               <div class="highlight"><pre>	</pre></div>             </td>           </tr>                               <tr id="section-59">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-59">&#182;</a>               </div>               <p>This function adds the waveform to the page.
It attempts to color it using canvas, if available, using the time div background color.
If canvas is not available, the waveform will be added as an image instead.
I use the following libraries to pull this off: modernizr, jquery.color, and jquery.getimagedata.</p>             </td>             <td class="code">               <div class="highlight"><pre>	
	<span class="kd">var</span> <span class="nx">loadWaveform</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">waveform_url</span><span class="p">){</span>
		</pre></div>             </td>           </tr>                               <tr id="section-60">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-60">&#182;</a>               </div>               <h4>Canvas Available</h4>             </td>             <td class="code">               <div class="highlight"><pre>		
		<span class="k">if</span><span class="p">(</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;html&#39;</span><span class="p">).</span><span class="nx">hasClass</span><span class="p">(</span><span class="s1">&#39;canvas&#39;</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
			
			<span class="kd">var</span> <span class="nx">waveform_color</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Color</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.time&#39;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;background-color&#39;</span><span class="p">))</span><span class="o">,</span>
					<span class="nx">canvas</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;waveform&quot;</span><span class="p">)</span><span class="o">,</span>
					<span class="nx">context</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s2">&quot;2d&quot;</span><span class="p">);</span>

			<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.track, .buffer, .played&#39;</span><span class="p">).</span><span class="nx">fadeOut</span><span class="p">(</span><span class="s1">&#39;fast&#39;</span><span class="o">,</span> <span class="kd">function</span><span class="p">(){</span>

				<span class="nx">context</span><span class="p">.</span><span class="nx">clearRect</span><span class="p">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="nx">context</span><span class="p">.</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span><span class="o">,</span> <span class="nx">context</span><span class="p">.</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>

				<span class="nx">$</span><span class="p">.</span><span class="nx">getImageData</span><span class="p">({</span>

				  <span class="nx">url</span><span class="o">:</span> <span class="nx">waveform_url</span><span class="o">,</span>

				  <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">image</span><span class="p">){</span>

						<span class="nx">context</span><span class="p">.</span><span class="nx">drawImage</span><span class="p">(</span><span class="nx">image</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="nx">context</span><span class="p">.</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span><span class="o">,</span> <span class="nx">context</span><span class="p">.</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>

						<span class="kd">var</span> <span class="nx">imgd</span> <span class="o">=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">getImageData</span><span class="p">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="nx">context</span><span class="p">.</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span><span class="o">,</span> <span class="nx">context</span><span class="p">.</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>

						<span class="kd">var</span> <span class="nx">pix</span> <span class="o">=</span> <span class="nx">imgd</span><span class="p">.</span><span class="nx">data</span><span class="o">;</span>

						<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">,</span> <span class="nx">n</span> <span class="o">=</span> <span class="nx">pix</span><span class="p">.</span><span class="nx">length</span><span class="o">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">n</span><span class="o">;</span> <span class="nx">i</span> <span class="o">+=</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>

							<span class="nx">pix</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">waveform_color</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span> <span class="c">// red</span>
							<span class="nx">pix</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">waveform_color</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span> <span class="c">// green</span>
							<span class="nx">pix</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nx">waveform_color</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span> <span class="c">// blue</span>

						<span class="p">}</span>

						<span class="nx">context</span><span class="p">.</span><span class="nx">putImageData</span><span class="p">(</span><span class="nx">imgd</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="p">);</span>

						<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.track, .buffer, .played&#39;</span><span class="p">).</span><span class="nx">fadeIn</span><span class="p">(</span><span class="s1">&#39;fast&#39;</span><span class="p">);</span>

				  <span class="p">}</span><span class="o">,</span>

				  <span class="nx">error</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">xhr</span><span class="o">,</span> <span class="nx">text_status</span><span class="p">){</span> <span class="p">}</span>

				<span class="p">});</span>

			<span class="p">});</span>
			</pre></div>             </td>           </tr>                               <tr id="section-61">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-61">&#182;</a>               </div>               <h4>Canvas Not Available</h4>             </td>             <td class="code">               <div class="highlight"><pre>			
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			
			<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.waveform img&#39;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;src&#39;</span><span class="o">,</span> <span class="nx">waveform_url</span><span class="p">);</span>
			
		<span class="p">}</span>	
		
	<span class="p">}</span>
	</pre></div>             </td>           </tr>                               <tr id="section-62">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-62">&#182;</a>               </div>               <h3>Load Comment</h3>             </td>             <td class="code">               <div class="highlight"><pre>	</pre></div>             </td>           </tr>                               <tr id="section-63">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-63">&#182;</a>               </div>               <p>Loads a single comment in the comments div and positions it accordingly.</p>             </td>             <td class="code">               <div class="highlight"><pre>	
	<span class="kd">var</span> <span class="nx">loadComment</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">track</span><span class="o">,</span> <span class="nx">comment</span><span class="p">){</span>
		</pre></div>             </td>           </tr>                               <tr id="section-64">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-64">&#182;</a>               </div>               <p>Only add if the comment has a timestamp</p>             </td>             <td class="code">               <div class="highlight"><pre>		
		<span class="k">if</span><span class="p">(</span><span class="nx">comment</span><span class="p">.</span><span class="nx">timestamp</span><span class="p">){</span>
			</pre></div>             </td>           </tr>                               <tr id="section-65">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-65">&#182;</a>               </div>               <p>Calculate the relative position of where the comment should be played on the comments timeline.</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nx">position</span> <span class="o">=</span> <span class="nx">comment</span><span class="p">.</span><span class="nx">timestamp</span> <span class="o">/</span> <span class="nx">track</span><span class="p">.</span><span class="nx">duration</span> <span class="o">*</span> <span class="mi">100</span><span class="o">;</span>
			</pre></div>             </td>           </tr>                               <tr id="section-66">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-66">&#182;</a>               </div>               <p>Create the comment, position it, and append it to <em>.comments</em>.</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="kd">var</span> <span class="nx">$comment</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;div class=&quot;comment&quot;&gt;&lt;/div&gt;&#39;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="o">,</span> <span class="nx">position</span> <span class="o">+</span> <span class="s2">&quot;%&quot;</span><span class="p">).</span><span class="nx">appendTo</span><span class="p">(</span><span class="s1">&#39;.comments&#39;</span><span class="p">);</span>
			</pre></div>             </td>           </tr>                               <tr id="section-67">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-67">&#182;</a>               </div>               <p>Create the user avatar and append it to the newly created comment.</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;div class=&quot;avatar&quot;&gt;&lt;/div&gt;&#39;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;background-image&#39;</span><span class="o">,</span> <span class="s1">&#39;url(&#39;</span> <span class="o">+</span> <span class="nx">comment</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">avatar_url</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">).</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">$comment</span><span class="p">);</span>
			
		<span class="p">}</span>
		
	<span class="p">}</span>
	</pre></div>             </td>           </tr>                               <tr id="section-68">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-68">&#182;</a>               </div>               <h3>Load Comments</h3>             </td>             <td class="code">               <div class="highlight"><pre>	</pre></div>             </td>           </tr>                               <tr id="section-69">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-69">&#182;</a>               </div>               <p>Loops all of a track's comments</p>             </td>             <td class="code">               <div class="highlight"><pre>	
	<span class="kd">var</span> <span class="nx">loadComments</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">track</span><span class="p">){</span>
		</pre></div>             </td>           </tr>                               <tr id="section-70">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-70">&#182;</a>               </div>               <p>Remove all existing comments</p>             </td>             <td class="code">               <div class="highlight"><pre>		
		<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.comments&#39;</span><span class="p">).</span><span class="nx">empty</span><span class="p">();</span>
		</pre></div>             </td>           </tr>                               <tr id="section-71">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-71">&#182;</a>               </div>               <p>Loop through each comment and call the <strong>loadComment</strong> function above</p>             </td>             <td class="code">               <div class="highlight"><pre>			
		<span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">track</span><span class="p">.</span><span class="nx">comments</span><span class="o">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">index</span><span class="o">,</span> <span class="nx">comment</span><span class="p">)</span> <span class="p">{</span>

			<span class="nx">loadComment</span><span class="p">(</span><span class="nx">track</span><span class="o">,</span> <span class="nx">comment</span><span class="p">);</span>

		<span class="p">});</span>
		
	<span class="p">}</span>
	</pre></div>             </td>           </tr>                               <tr id="section-72">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-72">&#182;</a>               </div>               <h3>Scrub</h3>             </td>             <td class="code">               <div class="highlight"><pre>	</pre></div>             </td>           </tr>                               <tr id="section-73">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-73">&#182;</a>               </div>               <p>Calculate relative position before calling the Seek function</p>             </td>             <td class="code">               <div class="highlight"><pre>	
	<span class="kd">var</span> <span class="nx">scrub</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="o">,</span> <span class="nx">xPos</span><span class="p">)</span> <span class="p">{</span>
		</pre></div>             </td>           </tr>                               <tr id="section-74">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-74">&#182;</a>               </div>               <p>Calculate the relative position and make sure it doesn't exceed the buffer's current width.</p>             </td>             <td class="code">               <div class="highlight"><pre>		
		<span class="nx">relative</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.buffer&#39;</span><span class="p">).</span><span class="nx">width</span><span class="p">()</span><span class="o">,</span> <span class="p">(</span><span class="nx">xPos</span> <span class="o">-</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.time&#39;</span><span class="p">).</span><span class="nx">offset</span><span class="p">().</span><span class="nx">left</span><span class="p">)</span> <span class="o">/</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.time&#39;</span><span class="p">).</span><span class="nx">width</span><span class="p">()</span> <span class="p">);</span>
		</pre></div>             </td>           </tr>                               <tr id="section-75">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-75">&#182;</a>               </div>               <p>Pass the relative position to the <em>onSeek</em> function.</p>             </td>             <td class="code">               <div class="highlight"><pre>		
		<span class="nx">onSeek</span><span class="p">(</span><span class="nx">relative</span><span class="p">);</span>

  <span class="p">};</span>
	</pre></div>             </td>           </tr>                               <tr id="section-76">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-76">&#182;</a>               </div>               <h3>Seek</h3>             </td>             <td class="code">               <div class="highlight"><pre>	</pre></div>             </td>           </tr>                               <tr id="section-77">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-77">&#182;</a>               </div>               <p>Seek the currently playing track</p>             </td>             <td class="code">               <div class="highlight"><pre>	
	<span class="kd">var</span> <span class="nx">onSeek</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">relative</span><span class="p">){</span>
		</pre></div>             </td>           </tr>                               <tr id="section-78">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-78">&#182;</a>               </div>               <p>Get the current active track</p>             </td>             <td class="code">               <div class="highlight"><pre>		
		<span class="nx">$track</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;li.active&#39;</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;track&#39;</span><span class="p">);</span>
		</pre></div>             </td>           </tr>                               <tr id="section-79">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-79">&#182;</a>               </div>               <p>Calculate a new position given the click's relative position and the track's duration.</p>             </td>             <td class="code">               <div class="highlight"><pre>		
		<span class="nx">position</span> <span class="o">=</span> <span class="nx">$track</span><span class="p">.</span><span class="nx">duration</span> <span class="o">*</span> <span class="nx">relative</span><span class="o">;</span>
		</pre></div>             </td>           </tr>                               <tr id="section-80">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-80">&#182;</a>               </div>               <p>Set the position in SoundManager2</p>             </td>             <td class="code">               <div class="highlight"><pre>		
		<span class="nx">soundManager</span><span class="p">.</span><span class="nx">setPosition</span><span class="p">(</span><span class="s1">&#39;track_&#39;</span> <span class="o">+</span> <span class="nx">$track</span><span class="p">.</span><span class="nx">id</span><span class="o">,</span> <span class="nx">position</span><span class="p">);</span> <span class="c">//.play();</span>
		
	<span class="p">}</span>
	
<span class="p">});</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 